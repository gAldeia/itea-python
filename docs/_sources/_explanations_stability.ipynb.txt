{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "760fb84a",
   "metadata": {},
   "source": [
    "# Explanations Stability\n",
    "\n",
    "In this notebook, we will explore how to calculate the stability of a local explanation for the Partial Effects explainer. We'll first start creating a classifier and fitting it with the iris data set. Then, we'll define the stability metric function and see how stable are the explanations.\n",
    "\n",
    "This example was inspired by the usage of the stability metric in _Plumb, Gregory, Maruan, Al-Shedivat, Ángel Alexander, Cabrera, Adam, Perer, Eric, Xing, and Ameet, Talwalkar. \"Regularizing Black-box Models for Improved Interpretability.\" . Advances in Neural Information Processing Systems (pp. 10526–10536). Curran Associates, Inc., 2020._"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "dd75b3fc",
   "metadata": {},
   "outputs": [],
   "source": [
    "import numpy  as np\n",
    "import pandas as pd\n",
    "\n",
    "# automatically differentiable implementation of numpy\n",
    "import jax.numpy as jnp # v0.2.13\n",
    "\n",
    "from sklearn import datasets\n",
    "\n",
    "from sklearn.model_selection import train_test_split\n",
    "from IPython.display         import display\n",
    "\n",
    "import matplotlib.pyplot as plt\n",
    "\n",
    "from itea.classification import ITEA_classifier\n",
    "from itea.inspection     import *\n",
    "\n",
    "import warnings\n",
    "warnings.filterwarnings(action='ignore', module=r'itea')"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0722b572",
   "metadata": {},
   "source": [
    "Let us start by loading the data set and fitting a simple classifier. Latter, the classifier will be used to explain a single instance and the stability of the explanation will be calculated for different sizes of neighborhoods."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "efbd78e4",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "gen | smallest fitness | mean fitness | highest fitness | remaining time (s)\n",
      "----------------------------------------------------------------------------\n",
      "  0 |         0.560000 |     0.848200 |        0.970000 | 0min17seg   \n",
      "  5 |         0.740000 |     0.961800 |        0.980000 | 0min12seg   \n",
      " 10 |         0.790000 |     0.969400 |        0.990000 | 0min13seg   \n",
      " 15 |         0.950000 |     0.982200 |        0.990000 | 0min10seg   \n",
      " 20 |         0.890000 |     0.982200 |        0.990000 | 0min10seg   \n",
      " 25 |         0.860000 |     0.982400 |        0.990000 | 0min11seg   \n",
      " 30 |         0.930000 |     0.981800 |        0.990000 | 0min6seg    \n",
      " 35 |         0.960000 |     0.982600 |        0.990000 | 0min5seg    \n",
      " 40 |         0.940000 |     0.981600 |        0.990000 | 0min3seg    \n",
      " 45 |         0.660000 |     0.973800 |        0.990000 | 0min2seg    \n"
     ]
    }
   ],
   "source": [
    "iris_data = datasets.load_iris()\n",
    "X, y      = iris_data['data'], iris_data['target']\n",
    "labels    = iris_data['feature_names']\n",
    "targets   = iris_data['target_names']\n",
    "\n",
    "# changing numbers to the class names\n",
    "y_targets = [targets[yi] for yi in y]\n",
    "\n",
    "X_train, X_test, y_train, y_test = train_test_split(\n",
    "    X, y_targets, test_size=0.33, random_state=42)\n",
    "\n",
    "# Creating transformation functions for ITEA using jax.numpy\n",
    "# (so we don't need to analytically calculate its derivatives)\n",
    "tfuncs = {\n",
    "    'id'       : lambda x: x,\n",
    "    'sqrt.abs' : lambda x: jnp.sqrt(jnp.abs(x)), \n",
    "    'log'      : jnp.log,\n",
    "    'exp'      : jnp.exp\n",
    "}\n",
    "\n",
    "clf = ITEA_classifier(\n",
    "    gens            = 50,\n",
    "    popsize         = 50,\n",
    "    max_terms       = 2,\n",
    "    expolim         = (-1, 1),\n",
    "    verbose         = 5,\n",
    "    tfuncs          = tfuncs,\n",
    "    labels          = labels,\n",
    "    simplify_method = 'simplify_by_var',\n",
    "    random_state    = 42,\n",
    ").fit(X_train, y_train)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d66374e5",
   "metadata": {},
   "source": [
    "## Local explanations with the Partial Effects\n",
    "\n",
    "To calculate the local explanations, we can use the function ``ITExpr_explainer.average_partial_effects``, passing as an argument a single sample we want to explain.\n",
    "\n",
    "We can see the explanation both visually or as an array with the importance for each feature.\n",
    "\n",
    "Let's start by creating an explainer instance.\n",
    "\n",
    "**NOTE**: In the remaining of this notebook, all local explanations will be calculated over the first element of the test set."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "6eeb7667",
   "metadata": {},
   "outputs": [],
   "source": [
    "explainer = ITExpr_explainer(\n",
    "    itexpr=clf.bestsol_,\n",
    "    tfuncs=tfuncs\n",
    ").fit(X_train, y_train)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c367859c",
   "metadata": {},
   "source": [
    "The visual inspection of feature importances can be useful in some cases:\n",
    "* The features are ordered by the most important to the least important feature;\n",
    "* The proportions between feature importances allows having a more clear understanding about its magnitudes;\n",
    "* We can see how much each class is using each feature to make its classification.\n",
    "\n",
    "It is important to notice that the prediction of the model is based on the class with the highest probability from the decision function. The decision function is a logit function using the IT expression as its linear model."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "cdd10d78",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "iVBORw0KGgoAAAANSUhEUgAAAdoAAAEHCAYAAAAJRIdeAAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjQuMiwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy8rg+JYAAAACXBIWXMAAAsTAAALEwEAmpwYAAA0IklEQVR4nO3de3wV1bn/8c8DIaKCAlo0EBQUgZgQAoiId7SiIq21oMDPW/B2qPff7+hBT6tS21P1eK9SsWpNi0qxqPVWqRXvyMUACQkBRGwEAooRBCLhkuT5/bEncSfZITshQ4B836/XfjF7Zs2aZw0bnr3WzJ5l7o6IiIiEo1VzByAiIrIvU6IVEREJkRKtiIhIiJRoRUREQqREKyIiEiIlWhERkRAlNHcAsuc555xzfMaMGc0dhojI3sTq2qAerdRSXFzc3CGIiOwzlGhFRERCpEQrIiISIiVaERGRECnRioiIhEiJVkREJERKtCIiIiFSohUREQmREq2IiEiITBO/S01tEhO9bMeOJqvvgMTWbDco21beZHWKiMSSlJzEmlVrmuPQdT4ZSolWajEzP3LCG01W35f3jQAgLSutyeoUEYklPzOfZspregSjiIhIc1CiFRERCZESrYiISIiUaEVEREKkRCsiIhIiJVoREZEQKdGKiIiESIlWREQkREq0IiIiIVKiFRERCZESrYiISIiUaEVEREKkRCsiIhIiJVoREZEQKdGKiEiLsGrVKoYOHUpKSgqpqak8+uijtco8//zzpKenk56ezoknnkhubm7Vtu+++45Ro0bRp08fUlJSmD17dlzHbXSiNbM/mdk6M8vfSZmLzWxR8PrEzPo19niNZWYdzOzaOMuWNPIY/zCzDjHWTzSzW4LlTDPrErWt0MwOjaPu/mb2dGPiqlFPXzPL2tV6RET2VgkJCTz44IMsWbKEOXPmMGnSJAoKCqqV6dGjBx988AGLFi3ijjvu4JprrqnadtNNN3HOOeewdOlScnNzSUlJieu4u9KjzQLOqafMv4HT3D0d+A3wx104XmN1AOJKtI3l7sPd/bt6imUCXeopE8t/A481Yr9q3D0PSDazI3a1LhGRvVFSUhIDBgwAoH379qSkpFBUVFStzIknnkjHjh0BOOGEE1i9ejUAmzZt4sMPP+TKK68EIDExkQ4dOsR13EYnWnf/EFhfT5lP3H1D8HYOkNzY41UKeolTzOxdM1tuZldHbbvVzD4NetC/DlbfCxxtZjlmdr+ZtTOzmWa2wMzyzOz8eo73X2Z2Y7D8sJm9GyyfaWbPBctVvVMz+6WZLTOzd4DewbpRwHHA80Ec+wfV3xAVR58Yx24PpLt7bvC+nZk9G5RfZGYjg/UlZnafmc03s3fM7Hgze9/MvjCzn0ZV+TowpkEnXERkH1RYWMjChQsZPHhwnWWeeeYZzj33XAC++OILfvSjHzFu3Dj69+/PVVddxffffx/XsXbnNdorgbdibTCzaUECqvm6rI660oHzgCHAnWbWxcyGAccAxwMZwEAzOxW4DVjh7hnufiuwFbjA3QcAQ4EHzcx2EveHwCnB8nFAOzNrA5wMfFSjHQOJJLL+wM+BQQDuPh3IBi4O4igNdikO4ngCuCXGsY8Doofm7wA2unvfYJTg3WD9gcD77j4Q2Az8FjgLuAC4O2r/7Ki2iIi0SCUlJYwcOZJHHnmEgw46KGaZ9957j2eeeYb77rsPgLKyMhYsWMAvfvELFi5cyIEHHsi9994b1/F2S6I1s6FEEu2EWNvdfXSQgGq+/lJHla+6e6m7FwPvEUmuw4LXQmAB0IdI4q0VDvA7M1sEvAN0BQ7bSfjziSTt9sA2YDaRBHgKNRJtsO4Vd9/i7puA13ZSL8DLUcfoHmN7EvBN1PsfA5Mq30SNFmwHZgTLecAH7r4jWI6udx11DF+b2TVmlm1m2fXELCKyR9u0aRPLly9n27Zt5OXlATB//nwA5s6dy8iRIxk6dCg//elPWbp0KSUlJRQWFlJcXMzatWv517/+xRVXXMFjjz3GAQccQEFBAV26dKFz584MHjyY+fPnM2rUKN577z0qKipqXeetKSHsBptZOvA0cK67f1tHmWkEw6w1PFRHsvUY7w24x92frFF39xplLwZ+BAx09x1mVgi0rSv+qDLjgE+ARUR6wkcDS+KIbWe2BX+WE/vvorRGbFZH/TvcvXJ9RWW97l5hZtH1tg3qrB20+x8JrqGbWUPaICKyRznooIOqeqp9+/YFYODAgbg7kyZNIiUlhQceeACAPn0iV+3atWsHwMqVK/nFL37B888/z4knngjAscceC8DRRx/NsmXLGDhwIBMnTmTIkCG0atWqantdQk20wY03LwOXuvtndZVz99ENrPp8M7uHyJDp6USGh0uB35jZ8+5eYmZdgR1EhlLbR+17MLAuSKBDgSPjON6HRIZ2ryDSS3wImB+V3KLLZZnZvUTO7U+AysRfM454LAH+M+r928D1wM0AZtYxqlcbj15UH4oWEWkxZs2axZQpU+jbty8ZGRkA/O53v2PlypUAjB8/nrvvvptvv/2Wa6+N3EObkJBAdnZkoO+xxx7j4osvZvv27Rx11FE8++yzcR230YnWzKYSSXKHmtlq4C53f8bMxgO4+2TgTuAQ4A/BZdAydz+usceMMg94EzgC+I27rwHWmFkKMDs4VglwibuvMLNZwc+Q3gLuA14PhkhzgKVxHO8j4JfAbHf/3sy2UnvYGHdfEPTOc4Ava5TJAiabWSmRa8v1cvelZnawmbV398prr5OCtpQDv+aH4ed4DCVy3kREWpyTTz6Z2v2j6p5++mmefjr2LyozMjKqkm5DWH0H3dOY2USgxN0faO5Ydgcz+7/AZnffpd/Smtl+wAfAye5eVk9ZP3LCG7tyuGq+vG8EAGlZaU1Wp4hILPmZ+fUm05DUeVOtngy153uCH67l7oojgNvqS7IiItK0Qr8Zqqm5+8TmjmF3cvetwJQmqGc5sHzXIxIRkYZQj1ZERCRESrQiIiIhUqIVEREJkRKtiIhIiJRoRUREQqREKyIiEiIlWhERkRAp0YqIiIRIiVZERCRESrQiIiIhUqIVEREJkRKtiIhIiJRoRUREQrTXzUcr4WuTmOhlO3Y0WX0HJLZmu0HZtvImq1NEJJak5CTWrFrTHIeucz7avW6aPAlfv/R0srOzmzsMEZF9goaORUREQqREKyIiEiIlWhERkRAp0YqIiIRIiVZERCRESrQiIiIhUqIVEREJkRKtiIhIiJRoRUREQqRHMEotdT2CUY9S3L2a8VFyItJwdT6CUYlWajEzP3LCG7XWf3nfCADSstJ2d0gtUn5mPvr3KbLXqDPRauhYREQkREq0IiIiIVKiFRERCZESrYiISIiUaEVEREKkRCsiIhIiJVoREZEQKdGKiIiESIlWREQkREq0IiIiIVKiFRERCZESrYiISIiUaEVEREKkRCsiIhIiJVqRvdCMGTPo3bs3PXv25N577621/f777ycjI4OMjAzS0tJo3bo169evZ+vWrRx//PH069eP1NRU7rrrrmaIXqRlaXCiNbNuZvaemS0xs8VmdlMd5Q42s9fNLDcoN27Xww2XmWWZ2ahG7DfezC6Lsb67meUHyxlmNjxq20QzuyWOus3M3jWzgxoaV4y63jGzjrtajzSv8vJyrrvuOt566y0KCgqYOnUqBQUF1crceuut5OTkkJOTwz333MNpp51Gp06d2G+//Xj33XfJzc0lJyeHGTNmMGfOnGZqiUjL0JgebRnwn+6eApwAXGdmx8Yodx1Q4O79gNOBB80ssdGR7sHcfbK7/6WeYhnA8HrKxDIcyHX3TY3Yt6YpwLVNUI80o3nz5tGzZ0+OOuooEhMTGTNmDK+++mqd5adOncrYsWMBMDPatWsHwI4dO9ixYwdmdc5XLSJNoMGJ1t3XuvuCYHkzsAToGqso0N4i/4rbAeuJJOlGM7PTzCwneC00s/bB+lvN7FMzW2Rmvw7WdTezpWb252D9dDM7INh2Z1A+38z+aDv5n8bMOpvZ/GC5n5m5mR0RvF9hZgdE907NbGDQi59N5MsGwReMu4HRQeyjg+qPNbP3zewLM7uxjhAuBqr+FzWzy4L25JrZlGBdlpk9EYw0fBGcpz8Fow5ZUXW9Boxt0EmXPU5RURHdunWrep+cnExRUVHMslu2bGHGjBmMHDmyal15eTkZGRl07tyZs846i8GDB4ces0hLtkvXaM2sO9AfmBtj8+NACrAGyANucveKGHVMi0qe0a9aQ7HALcB17p4BnAKUmtkw4BjgeCK9xoFmdmpQvjfwR3dPBzbxQ2/ucXcf5O5pwP7AiLra6O7rgLbB0O0pQDZwipkdCaxz9y01dnkWuNHdh0TVsR24E5jm7hnuPi3Y1Ac4O4j9LjNrEyOEk4DKRJ8K/BI4IxgpiB627wicAfxf4HXgYSAV6GtmGUEcG4D9zOyQutorez53r7Wuru+Kr7/+OieddBKdOnWqWte6dWtycnJYvXo18+bNIz8/P7RYRWQXEq2ZtQNeAm6uY1jzbCAH6EIkAT4e6zqju48Okk/NV6yh2FnAQ0Hvr4O7lwHDgtdCYAGR5HVMUH6Vu88Klp8DTg6Wh5rZXDPLI5KcUutp7idEEt6pwO+CP08BPqpxTg4O4vogWDWlnnrfdPdt7l4MrAMOi1GmUzByQBDr9KA87r4+qtzrHvkfOA/42t3zgi82i4HuUeXWEfk7qcbMrjGzbDPLridm2c3mz58PQG5uLmVlZZSVlVFYWEhhYSHFxcUsWbKEdu3asWHDBlasWEFpaSkFBQVUVFQwefJkxo4dW1XHggULqKiooKCggP3224/09HRefvllioqKWLt2LcXFxRQWFlJSUsLSpUspKysjNze3WhyVf+bl5bFt2zaWL1/Opk2bWLlyJevWrWPdunWsXLmSTZs2sXz5crZt20ZeXl7MOirbtHTpUkpKSqratHbtWoqKimK2acGCBdXqiG5TaWkpK1asYMOGDWqT2rRb27QzFuvbcX2CntcbwD/d/aE6yrwJ3OvuHwXv3wVuc/d5NcpNI9LzrOmhWMnWzPoSuW55A/Bj4GrgM3d/ska57sAH7n5k8P6MYJ+xwJfAce6+yswmArj7xGCY9Q13n16jrsuIJPAzgSFEEm9OUPaNoI4S4Gki11Mrj5kOvODuaWaWGRzz+mDbRKDE3R8I3ucDI9y9sMaxNwCHuHtF8AWjs7v/qkaZqriDdr8R9Nap2aZgGHy0u38e45xX1udHTnij1vov74t0/NOy0uraVZpQfmZ+zN5rWVkZvXr1YubMmXTt2pVBgwbxwgsvkJpa/fvixo0b6dGjB6tWreLAAw8E4JtvvqFNmzZ06NCB0tJShg0bxoQJExgxos5BHRGJT52XIBtz17EBzwBL6kqygZVEEhNmdhiRZPpFzUIN6dGa2dFBT+0+IkO4fYB/AlcEPWzMrKuZdQ52OcLMKodwxwIfA22D98XBPvHcZfwhcAmwPOglrieS7GdFF3L374CNZlbZc744avNmoH0cx6ppGXBUsDwTuKhy6NfMOtW5VwzB393hQGEj4pA9REJCAo8//jhnn302KSkpXHTRRaSmpjJ58mQmT55cVe6VV15h2LBhVUkWYO3atQwdOpT09HQGDRrEWWedpSQrErKERuxzEnApkGdmOcG6/3b3f5jZeIjchQv8BsgKhmcNmFA55LkLbjazoUA5UAC85e7bzCwFmB1cpyohkhTLidyodbmZPQksB55w9y1m9hSRIdZC4NP6DuruhUHdHwarPgaSg2ueNY0D/mRmW4h8Caj0HnBbcM7uaUCb3yRy1/bn7r7YzP4H+MDMyokMl2c2oK6BwJxgyF32YsOHD2f48Oo3sY8fP77a+8zMTDIzM6utS09PZ+HChWGHJyJRGjV0vDeoOYS6tzKzJOAv7n5WE9T1KPCau8+sp5yGjvcAdQ0di8geqemGjmX3cve1wFOxbiRrhPz6kqyIiDStxgwd7xWCm4r2ia6Xu7/YRPU81RT1iIhI/NSjFRERCZESrYiISIiUaEVEREKkRCsiIhIiJVoREZEQKdGKiIiESIlWREQkREq0IiIiIVKiFRERCZESrYiISIiUaEVEREKkRCsiIhIiJVoREZEQ7bPz0UrjtUlM9LIdO2qtPyCxNdsNyraVN0NULU9SchJrVq1p7jBEJD51zke7z06TJ43XLz2d7Ozs5g5DRGSfoKFjERGRECnRioiIhEiJVkREJERKtCIiIiFSohUREQmREq2IiEiIlGhFRERCpEQrIiISIiVaERGREOkRjFJLXY9gbJXYiortFc0QUcujxy+K7HXqfASjEq3UYmZ+5IQ3aq3/8r4RpGWlNUNELU9+Zj76tymyV6kz0WroWEREJERKtCIiIiFSohUREQmREq2IiEiIlGhFRERCpEQrIiISIiVaERGRECnRioiIhEiJVkREJERKtCIiIiFSohUREQmREq2IiEiIlGhFRERCpEQrIiISIiVakb3MjBkz6N27Nz179uTee++ttf3+++8nIyODjIwM0tLSaN26NevXr2fVqlUMHTqUlJQUUlNTefTRR5shepGWp0GJ1sxam9lCM6s9WWlk+61mlhO88s2s3Mw6NU2occfYwcyujbNsSUPW7wozyzCz4VHvJ5rZLXHsZ2b2rpkd1AQxvGNmHXe1Hmk+5eXlXHfddbz11lsUFBQwdepUCgoKqpW59dZbycnJIScnh3vuuYfTTjuNTp06kZCQwIMPPsiSJUuYM2cOkyZNqrWviDS9hvZobwKW1LXR3e939wx3zwBuBz5w9/W7EF9jdADiSrS7WQYwvL5CMQwHct19UxPEMIU989xInObNm0fPnj056qijSExMZMyYMbz66qt1lp86dSpjx44FICkpiQEDBgDQvn17UlJSKCoq2i1xi7RkcSdaM0sGzgOejnOXscDUxgRV47gTzWxK0KtbbmZXR2271cw+NbNFZvbrYPW9wNFBr/p+M2tnZjPNbIGZ5ZnZ+Q08fq1jmFl3M1tiZk+Z2WIze9vM9g+2DQrKzg6On29micDdwOggrtFB9cea2ftm9oWZ3VhHCBcDVf+TmtllQf25ZjYlWJdlZk+Y2XtBXaeZ2Z+CGLOi6nqNyN+L7KWKioro1q1b1fvk5OQ6k+WWLVuYMWMGI0eOrLWtsLCQhQsXMnjw4NBiFZGIhAaUfQT4L6B9fQXN7ADgHOD6OrZPA3rH2PSQu/8lxvp04ATgQGChmb0JpAHHAMcDBrxmZqcCtwFpQa8aM0sALnD3TWZ2KDDHzF5zd4+jHcPqOMbKYP1Yd7/azF4ERgLPAc8C17j7J2Z2L4C7bzezO4Hj3P36oO6JQB9gKJFzuszMnnD3HTXCOAn4j2CfVOCXwEnuXlxjWL4jcAbwU+D1YL+rgE/NLMPdc9x9g5ntZ2aHuPu39bVf9jyxPrZmFrPs66+/zkknnUSnTtWv3pSUlDBy5EgeeeQRDjpol69IiEg94urRmtkIYJ27z4+z3p8As+oaNnb30ZVDzDVesZIswKvuXuruxcB7RBLfsOC1EFhAJGkdEyt84Hdmtgh4B+gKHBZnO3Z2jH+7e06wPB/obmYdgPbu/kmw/oV66n/T3bcF7VpXR1yd3H1zsHwGMD0oT43z+3rw5SEP+Nrd89y9AlgMdI8qtw7oUvMgZnaNmWWbWXY9MctuMn/+/Gp/5ubmcvjhh7N06VJKSkooLCxk2bJltG/fnqKiIjZs2MCKFSsoLS2tun57wgknVKtj7ty5/PznP+fMM8/k3HPPZcWKFWzYsIGioiLWrl1LcXExhYWFlJSUsHTpUsrKysjNzY0ZT15eHtu2bWP58uVs2rSJlStXsm7dOtatW8fKlSvZtGkTy5cvZ9u2beTl5dXZprKysmptKi4uZu3atTHbVFFRwYIFC6rVsWDBAioqKigoKKC0tFRtUpuapU07Y3F07DCze4BLgTKgLXAQ8LK7X1JH+VeAv7l7zETTkB5t0PMzd78reP8X4CXgVOAzd3+yRvnuwBvunha8zwTOBS5x9x1mVgic7u6FZlbi7u1ixFfi7u3M7ME4j3EL0A54FMhx9yOD9enAC+6eFsRRs0db4u4PBO/zgRHuXljjWBuAQ9y9Ihhe7uzuv6pRJiuIZ3qM2Kq2Be/nA6Pd/fOa7Y6qz4+cUPt+ty/vG0FaVlpdu0kTys/Mj9l7LSsro1evXsycOZOuXbsyaNAgXnjhBVJTU6uV27hxIz169GDVqlUceOCBQKQ3fPnll9OpUyceeeSR3dEMkZYk9tAScfZo3f12d0929+7AGODdnSTZg4HTiLquGKO+hvZozzeztmZ2CHA68CnwT+AKM2sXHLermXUGNlN9ePtgIr3xHWY2FDgynjYH6jpGXe3aAGw2sxOCVWOiNteMK17LgKOC5ZnARcF5wBp4R7dFxhgPBwobEYfsARISEnj88cc5++yzSUlJ4aKLLiI1NZXJkyczefLkqnKvvPIKw4YNq0qyALNmzWLKlCm8++67VT//+cc//tEczRBpURpyjTYmMxsP4O6V/8ovAN529+93te4o84A3gSOA37j7GmCNmaUAs4NrVCVEeq0rzGxW0EN8C7gPeD0YEs0BlsZ7UHd/O9YxgPKd7HYl8JSZfQ+8D2wM1r8H3GZmOcA98cZApN2nA5+7+2Iz+x/gAzMrJzKkndmAugYCc9y9rAH7yB5m+PDhDB9e/Qb28ePHV3ufmZlJZmZmtXUnn3xyzF6yiIQrrqHj5lRziHVPZ2bt3L0kWL4NSHL3m3ahviTgL+5+VhPE9ijwmrvPrKecho6bWV1DxyKyx6pz6HiXe7RSy3lmdjuRc/slDetx1uLua4OfER3UBL+lza8vyYqISNPa4xOtu09s7hgawt2nAdOauM4Xm6iep5qiHhERiZ+edSwiIhIiJVoREZEQKdGKiIiESIlWREQkREq0IiIiIVKiFRERCZESrYiISIiUaEVEREKkRCsiIhIiJVoREZEQKdGKiIiESIlWREQkREq0IiIiIdrj56OV3a9NYqKX7dhRa32rxFZUbK9ohohanqTkJNasWtPcYYhI/DQfrcSvX3o62dnZzR2GiMg+QUPHIiIiIVKiFRERCZESrYiISIiUaEVEREKkRCsiIhIiJVoREZEQKdGKiIiESL+jFRHZx+3YsYPVq1ezdevW5g5lr9e2bVuSk5Np06ZN3Pso0YqI7ONWr15N+/bt6d69O2Z1PsBI6uHufPvtt6xevZoePXrEvZ+GjqWWnJyFtGmbgJk1+NWlW5fmDl9Eati6dSuHHHKIkuwuMjMOOeSQBo8MqEcrtZSXV0A5pGWlNXjf/Mz8ECISkV2lJNs0GnMe1aMVEREJkRKtiEgLk5R8RKMuDdX1Sko+osliy8rKYs2afWvmKg0di4i0MF8VreLICW80WX1f3jeiyerKysoiLS2NLl32nfs91KMVEZFQff/995x33nn069ePtLQ0pk2bxvz58znttNMYOHAgZ599NmvXrmX69OlkZ2dz8cUXk5GRQWlpKTNnzqR///707duXK664gm3btgFw2223ceyxx5Kens4tt9wCwOuvv87gwYPp378/P/7xj/n666+bs9lVlGhFRCRUM2bMoEuXLuTm5pKfn88555zDDTfcwPTp05k/fz5XXHEFv/zlLxk1ahTHHXcczz//PDk5OZgZmZmZTJs2jby8PMrKynjiiSdYv349r7zyCosXL2bRokX86le/AuDkk09mzpw5LFy4kDFjxvC///u/zdzyCA0di4hIqPr27cstt9zChAkTGDFiBB07diQ/P5+zzjoLgPLycpKSkmrtt2zZMnr06EGvXr0AuPzyy5k0aRLXX389bdu25aqrruK8885jxIjI0PXq1asZPXo0a9euZfv27Q36rWuY1KMVEZFQ9erVi/nz59O3b19uv/12XnrpJVJTU8nJySEnJ4e8vDzefvvtWvu5e8z6EhISmDdvHiNHjuTvf/8755xzDgA33HAD119/PXl5eTz55JN7zJOwlGhFRCRUa9as4YADDuCSSy7hlltuYe7cuXzzzTfMnj0biDwicvHixQC0b9+ezZs3A9CnTx8KCwv5/PPPAZgyZQqnnXYaJSUlbNy4keHDh/PII4+Qk5MDwMaNG+natSsAf/7zn3dzK+umoWMRkRbm8K7dmvRO4cO7dtvp9ry8PG699VZatWpFmzZteOKJJ0hISODGG29k48aNlJWVcfPNN5OamkpmZibjx49n//33Z/bs2Tz77LNceOGFlJWVMWjQIMaPH8/69es5//zz2bp1K+7Oww8/DMDEiRO58MIL6dq1KyeccAL//ve/m6yNu8Lq6ppLy2VmDo1/MpQ+UyJ7liVLlpCSktLcYewz6jifdT4ySkPHIiIiIVKiFRERCZESrYiISIiUaEVEREKkRCu7zYwZM+jduzc9e/bk3nvvrbV96dKlDBkyhP32248HHnig2rYrrriCzp07k5bW8Bu0RESaU72J1sw6mNl0M1tqZkvMbEiMMn3MbLaZbTOzW8IJtWmZWZaZjYp3fRMc77+jlrubWVwTt5rZzWZ2WRMc/3ozG7er9TRWeXk51113HW+99RYFBQVMnTqVgoKCamU6derE73//+6rnlkbLzMxkxowZuytcEZEmE0+P9lFghrv3AfoBS2KUWQ/cCDwQY5tE/Hf9RaozswTgCuCFJjj+n4j8HTWLefPm0bNnT4466igSExMZM2YMr776arUynTt3ZtCgQbRp06bW/qeeeiqdOnXaXeGK7NO6Jyc16TR5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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "explainer.plot_feature_importances(\n",
    "    X = X_test[0, :].reshape(1, -1),\n",
    "    importance_method = 'pe',\n",
    "    grouping_threshold = 0.0,\n",
    "    target = None,\n",
    "    barh_kw = {'edgecolor' : 'k'},\n",
    "    show = True\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "950354b9",
   "metadata": {},
   "source": [
    "We can use the ``average_partial_effects`` directly to obtain an array with numeric explanations, making it easy to manipulate the values to assess stabilities."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "3c3ea1c1",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[6.85112219e-03, 5.00492617e-02, 4.76003440e-02, 1.51608147e-01],\n",
       "       [2.74413002e-04, 3.40860669e-03, 1.31835324e-03, 6.55848291e-03],\n",
       "       [1.03778588e-01, 6.74201575e-01, 6.71034697e-01, 2.10067814e+00]])"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "explainer.average_partial_effects(X_test[0, :].reshape(1, -1))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5b951658",
   "metadata": {},
   "source": [
    "The function returns an array, where each line corresponds to the importance for each class. As we can see from the bar plot, the total importance for a given feature is the summation of the importance for each class:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "54d685d3",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([0.11090412, 0.72765944, 0.71995339, 2.25884477])"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "np.sum(\n",
    "    explainer.average_partial_effects(X_test[0, :].reshape(1, -1)),\n",
    "    axis=0\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "95424fe5",
   "metadata": {},
   "source": [
    "## Stability of an explanation\n",
    "\n",
    "In the mentioned paper, the authors discuss metrics to evaluate model agnostic explainers.\n",
    "\n",
    "The stability measures how much the explanation changes when the feature slightly changes, where lower values are better. Higher values imply that, when the feature being explained changes in a small proportion, the feature importances responds in a much larger proportion, then the explainer is not reliable since it is not locally stable, and cannot be trusted for the given instance.\n",
    "\n",
    "Let $f:\\mathbf{x} \\rightarrow y$, with $\\mathbf{x} = \\{x_0, x_1, ..., x_n\\}$ be a model we want to explain, and $g: (f, \\mathbf{x}_i) \\rightarrow \\mathbf{e}$ a explainer that takes a model and a instance to explain and attributes one feature importance for each $x \\in \\mathbf{x}_i$. \n",
    "\n",
    "The stability of the explanation is calculated by:\n",
    "\n",
    "$$S(f, g, \\mathbf{x}_i, \\mathbf{N}_{\\mathbf{x}_i}) = \\mathbb{E}_{\\mathbf{x}_j \\sim \\mathbf{N}_{\\mathbf{x}_i}} \\left [ || g(\\mathbf{x}_i, f) - g(\\mathbf{x}_j, f)||_{2}^{2} \\right ].$$\n",
    "\n",
    "In other words, the stability function evaluates the mean distance between the explanation for the original input and all sampled neighbors."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "cb609adc",
   "metadata": {},
   "outputs": [],
   "source": [
    "def explain_single(x):\n",
    "    \"\"\"wrapping the process to explain a single instance.\n",
    "    \n",
    "    The input x should be a single observation of shape (n_features, ).\n",
    "    \"\"\"\n",
    "    \n",
    "    return np.sum(\n",
    "        explainer.average_partial_effects(x.reshape(1, -1)),\n",
    "        axis=0\n",
    "    )\n",
    "\n",
    "\n",
    "def norm_p2(vector):\n",
    "    \"\"\"p2 norm of a vector.\n",
    "    \n",
    "    the vector should be an array of shape (n, ).\n",
    "    \"\"\"\n",
    "    \n",
    "    return np.sqrt(np.sum(np.abs(np.power(vector, 2))))\n",
    "\n",
    "\n",
    "def stability(explainer, x, neighborhood):\n",
    "    \"\"\"Stability function.\n",
    "    \n",
    "    Takes as argument an explanation method, a single observation\n",
    "    x of shape (n_features, ), and the neighborhood as a matrix of\n",
    "    shape (n_neighbors, n_features), where each line is a sampled\n",
    "    neighbor and each column is the feature value of the sample.\n",
    "    \n",
    "    Returns the mean squared p2-norm of the difference between the\n",
    "    original explanation and every sampled neighbor.\n",
    "    \"\"\"\n",
    "    \n",
    "    original_explanation = explainer(x)\n",
    "    return np.nanmean([\n",
    "        norm_p2(explainer(nb) - original_explanation)**2\n",
    "        for nb in neighborhood\n",
    "    ])\n",
    "        \n",
    "    \n",
    "def neighborhood(x, factor, size=100):\n",
    "    \"\"\"Method to create samples around a given observation x.\n",
    "    \n",
    "    This method uses a multivariate normal distribution to \n",
    "    randomly select feature values. The sigma of the distribution\n",
    "    is calculated over the training data to mimic the original\n",
    "    distributions and a scaling factor is multiplied to \n",
    "    adjust how large will be the neighborhood.\n",
    "    \n",
    "    It is possible to specify the number of generated samples\n",
    "    by setting the size to a different value (default=100).\n",
    "    \n",
    "    Returns a matrix of shape (size, n_features) containing\n",
    "    the sampled neighbors.\n",
    "    \"\"\"\n",
    "    \n",
    "    cov = np.cov(X_train.T)\n",
    "\n",
    "    return np.random.multivariate_normal(x, cov*factor, size=size)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "cf2fc761",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.01040152988347714"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "stability(\n",
    "    explain_single,\n",
    "    X_test[0],\n",
    "    neighborhood(X_test[0], 0.001)\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e8469106",
   "metadata": {},
   "source": [
    "## Increasing the neighborhood to measure stability\n",
    "\n",
    "In the original work, the authors used fixed values for creating the neighborhood to evaluate stability.\n",
    "\n",
    "I think this can be limiting in some situations. To verify, we will evaluate how stability changes when we increase the size of the neighborhood."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "83eb27cb",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 576x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "fig, axs = plt.subplots(1, 1, figsize=(8,4))\n",
    "\n",
    "factors = np.linspace(0.001, 1, 100)\n",
    "\n",
    "axs.plot(\n",
    "    factors,\n",
    "    [stability(\n",
    "        explain_single,\n",
    "        X_test[0],\n",
    "        neighborhood(X_test[0], factor, size=20)\n",
    "    ) for factor in factors]\n",
    ")\n",
    "\n",
    "axs.set_title(\"Stability of explanation (smaller is better)\")\n",
    "axs.set_ylabel(\"Stability\")\n",
    "axs.set_xlabel(\"Multiplying factor\")\n",
    "\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3a1d7171",
   "metadata": {},
   "source": [
    "## The Jaccard Index\n",
    "\n",
    "In _Zhengze Zhou, Giles Hooker, Fei Wang. \"S-LIME: Stabilized-LIME for Model Explanation\".\tIn Proceedings of the 27th ACM SIGKDD Conference on Knowledge Discovery and Data Mining (KDD '21), August 14--18, 2021, Virtual Event, Singapore_, the authors used the Jaccrd index to evaluate the stability of a function.\n",
    "\n",
    "$$J(A, B) = \\frac{|A \\cap B|}{|A \\cup B|}.$$\n",
    "\n",
    "This method ignores ordering, and is only concerned if the most important features will always be the same. Values close to 1 means that the algorithm is stable accros different iterations.\n",
    "\n",
    "The Jaccard index is the ratio of the intersection over the union of two data sets. In the paper, to evaluate the stability for aa given test instance $t$, they:\n",
    "1. Execute the explanation method 20 times;\n",
    "2. Saved the $k$ most important features (with $k=\\{1, 2, 3, 4, 5\\}$);\n",
    "3. For each value of $k_i$, the $k_i$ most important features for each execution were used to calculate the Jaccard index across all possible pairs (20*19 pairs), then the average was reported.\n",
    "\n",
    "Their result look like this:\n",
    "\n",
    "| k | Jaccard Index for the method |\n",
    "|---|:----------------------------:|\n",
    "| 1 |             1.0              |\n",
    "| 2 |             0.2              |\n",
    "| 3 |             0.8              |\n",
    "| 4 |             0.7              |\n",
    "| 5 |             0.0              |\n",
    "\n",
    "\n",
    "### Adaptating the Jaccard Index\n",
    "\n",
    "In the cell below the Jaccard Index is used to evaluate stability, but since the Partial Effects explanation method is deterministic, the calculation will be performed on the neighborhood of the test point. We can use ``explain_single`` and ``neighborhood`` functions previously declared."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "154e3d22",
   "metadata": {},
   "outputs": [],
   "source": [
    "def jaccard_index(A, B):\n",
    "    \"\"\"Method to calculate the ratio of the intersection\n",
    "    over the union of two sets. This is known as Jaccard\n",
    "    index and ranges from 0 to 1, measuring how simmilar\n",
    "    the two sets are. A value equals to 1 means that the \n",
    "    sets are identical (remembering that sets does not\n",
    "    have order relations between its elements), and a \n",
    "    value equals to 0 means that they are completely\n",
    "    different. \n",
    "    \n",
    "    Takes as argument two python built-in sets A and B.\n",
    "    \n",
    "    Returns a float number representing the Jaccard Index.\n",
    "    \"\"\"\n",
    "    \n",
    "    return len(A.intersection(B)) / len(A.union(B))\n",
    "\n",
    "\n",
    "def get_k_most_important(explanation, k):\n",
    "    \"\"\"Method that takes an array of explanation and \n",
    "    returns the index of the k most important (highest)\n",
    "    values in the array.\n",
    "    \n",
    "    Takes an array of explanations of shape (n_features, )\n",
    "    and an integer k representing the size of the subset,\n",
    "    k <= len(explanations).\n",
    "    \n",
    "    Returns a python built-in set containing the indexes\n",
    "    of the k highest values.\n",
    "    \"\"\"\n",
    "    \n",
    "    # Reversing the order so its in descending order\n",
    "    order = np.argsort(explanation)[::-1]\n",
    "\n",
    "    \n",
    "    return set(order[:k])\n",
    "    \n",
    "\n",
    "def jaccard_stability(explainer, x, neighborhood, k):\n",
    "    \"\"\"Jaccard adaptation Stability function.\n",
    "    \n",
    "    Takes as argument an explanation method, a single observation\n",
    "    x of shape (n_features, ), the neighborhood as a matrix of\n",
    "    shape (n_neighbors, n_features), and the size of the subset being\n",
    "    considered k\n",
    "    \n",
    "    Returns the mean Jaccard Index between the original sample\n",
    "    and all neighbors, considering how similar the k most important\n",
    "    subset of features between the explanation of the original data\n",
    "    and its neighbors.\n",
    "    \"\"\"\n",
    "    \n",
    "    original_explanation = explainer(x)\n",
    "    original_jaccard_set = get_k_most_important(original_explanation, k)\n",
    "    \n",
    "    return np.nanmean([\n",
    "        jaccard_index(\n",
    "            get_k_most_important(explainer(nb), k),\n",
    "            original_jaccard_set\n",
    "        )\n",
    "        for nb in neighborhood\n",
    "    ])"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "69239668",
   "metadata": {},
   "source": [
    "In te cell below we create a table similar to the one reported in the S-LIME paper. For different multiplication factors that adjusts the size of the neighborhood, we can see how stable the explanations are in terms of returning the same most important features.\n",
    "\n",
    "Notice that the maximum number of features is 4."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "6aa92aa3",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>k=1</th>\n",
       "      <th>k=2</th>\n",
       "      <th>k=3</th>\n",
       "      <th>k=4</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>factor 0.001</th>\n",
       "      <td>1.00</td>\n",
       "      <td>0.746667</td>\n",
       "      <td>1.000</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>factor 0.01</th>\n",
       "      <td>1.00</td>\n",
       "      <td>0.713333</td>\n",
       "      <td>1.000</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>factor 0.1</th>\n",
       "      <td>1.00</td>\n",
       "      <td>0.660000</td>\n",
       "      <td>1.000</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>factor 1.0</th>\n",
       "      <td>0.95</td>\n",
       "      <td>0.673333</td>\n",
       "      <td>0.945</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "               k=1       k=2    k=3  k=4\n",
       "factor 0.001  1.00  0.746667  1.000  1.0\n",
       "factor 0.01   1.00  0.713333  1.000  1.0\n",
       "factor 0.1    1.00  0.660000  1.000  1.0\n",
       "factor 1.0    0.95  0.673333  0.945  1.0"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "ks = [1, 2, 3, 4]\n",
    "fs = [0.001, 0.01, 0.1, 1.0]\n",
    "\n",
    "jaccard_df = pd.DataFrame(\n",
    "    data   = [[jaccard_stability(explain_single, X_test[0], neighborhood(X_test[0], f, size=100), k=k)\n",
    "              for k in ks] for f in fs],\n",
    "    index   = [f'factor {f}' for f in fs],\n",
    "    columns = [f'k={k}' for k in ks]\n",
    ")\n",
    "\n",
    "display(jaccard_df)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
